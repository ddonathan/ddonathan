<!-- 
	TODO Should we set the buffer based on what the possible options are? Currently we do this with BBO vs NonBBO, but could we go further? If they haven't chosen invoicing, then building an invoice export isn't possible. 
	TODO Should we have presets like (Enterprise Only, Growth, Healthcare, BH1, etc.)
  TODO Form Validation
    - Start some fields without any value so it forces a choice
      - Timeline to use
	TODO Show pricing of other options $500/ea, etc.
  TODO Allow additional data sources
  TODO 12 users is 19.5k, 13 is 15.5k. Look at discount percentages to make sure they work
  TODO Link isn't always updating. Test it.
  TODO Secure the link so not just anyone can get to it.
  TODO Make it one link
  TODO Save baseprice, additions, discount to the link so even if the calculations change, we have it.
 -->
<!DOCTYPE html>
<html lang="en">

<head>
  <title>THQ Proposal Pricing</title>
  <link rel="shortcut icon" type="image/png" href="favicon.png" />
  <!-- Bootstrap -->
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous" />

  <!-- Docx Templater -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.19.7/docxtemplater.js"></script>
  <script src="https://unpkg.com/pizzip@3.0.6/dist/pizzip.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
  <script src="https://unpkg.com/pizzip@3.0.6/dist/pizzip-utils.js"></script>
  <!--
    Mandatory in IE 6, 7, 8 and 9.
    -->
  <!--[if IE]>
        <script type="text/javascript" src="https://unpkg.com/pizzip@3.0.6/dist/pizzip-utils-ie.js"></script>
    <![endif]-->
  <script>
    function loadFile(url, callback) {
      PizZipUtils.getBinaryContent(url, callback);
    }
    function generate() {
      loadFile("template.docx", function (error, content) {
        if (error) { throw error };

        // The error object contains additional information when logged with JSON.stringify (it contains a properties object containing all suberrors).
        function replaceErrors(key, value) {
          if (value instanceof Error) {
            return Object.getOwnPropertyNames(value).reduce(function (error, key) {
              error[key] = value[key];
              return error;
            }, {});
          }
          return value;
        }

        function errorHandler(error) {
          console.log(JSON.stringify({ error: error }, replaceErrors));

          if (error.properties && error.properties.errors instanceof Array) {
            const errorMessages = error.properties.errors.map(function (error) {
              return error.properties.explanation;
            }).join("\n");
            console.log('errorMessages', errorMessages);
            // errorMessages is a humanly readable message looking like this :
            // 'The tag beginning with "foobar" is unopened'
          }
          throw error;
        }

        var zip = new PizZip(content);
        var doc;
        try {
          doc = new window.docxtemplater(zip);
        } catch (error) {
          // Catch compilation errors (errors caused by the compilation of the template : misplaced tags)
          errorHandler(error);
        }

        doc.setData({
          first_name: 'John',
          last_name: 'Doe',
          phone: '0652455478',
          description: 'New Website'
        });
        try {
          // render the document (replace all occurences of {first_name} by John, {last_name} by Doe, ...)
          doc.render();
        }
        catch (error) {
          // Catch rendering errors (errors relating to the rendering of the template : angularParser throws an error)
          errorHandler(error);
        }

        var out = doc.getZip().generate({
          type: "blob",
          mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
        }) //Output the document using Data-URI
        saveAs(out, "output.docx")
      })
    }
  </script>

  <script>
    function QueryStringToJSON() {
      var pairs = location.search.slice(1).split("&");

      var result = {};
      pairs.forEach(function (pair) {
        pair = pair.split("=");
        result[pair[0]] = decodeURIComponent(pair[1] || "");
      });

      return JSON.parse(JSON.stringify(result));
    }

    // save query_string
    var query_string = QueryStringToJSON();

    // OnLoad
    window.onload = function () {

      var form = document.querySelector("form");
      form.addEventListener("change", function () {
        calculatePricing();
      });

      // Set reset form url to the url they came in with
      document.getElementById("resetForm").addEventListener("click", function () {
        window.location = window.location.href;
      });
      document.getElementById("resetForm").addEventListener("dblclick", function () {
        window.location = "proposalCalculator.html";
      });

      // Initialize all tooltips
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
      })

      // Set values from the querystring
      for (const key in query_string) {
        if (document.getElementById(key) && query_string[key]) {
          // If it's a checkbox, check it, otherwise set the value
          if (document.getElementById(key).type === "checkbox") document.getElementById(key).checked = true;
          else document.getElementById(key).value = query_string[key]
        }
      }

      // Set focus to companyName
      document.getElementById("companyName").focus();

      // Trigger the pricing to be calculated
      calculatePricing();
    };

    function calculatePricing() {
      // lookup
      var container = {
        query_string: query_string,
        lookup: {
          buffer: 0.1,
          padding: 2000,
          paddingBBO: 4000,
          paddingBH1: 25000,
          baseUserPrice: 1050,
          products: {
            ats: {
              name: "ATS",
              pricing: "65"
            },
            crm: {
              name: "CRM",
              pricing: "20"
            },
            time_expense: {
              name: "Time/Expense",
              pricing: "65"
            },
            invoicing: {
              name: "Invoicing",
              pricing: "65"
            },
            pay_bill: {
              name: "Pay/Bill",
              pricing: "2650"
            },
            onboarding: {
              name: "Onboarding",
              pricing: "65"
            },
            vms_submittals: {
              name: "VMS Submittals",
              pricing: "30"
            },
            vms_sync: {
              name: "VMS Sync",
              pricing: "30"
            },
            canvas: {
              name: "Canvas",
              pricing: "65"
            }
          },
          additions: {
            newHireExport: {
              pricing: 500,
              method: "$"
            },
            qbIntegration: {
              pricing: 500,
              method: "$"
            },
            InvoiceExport: {
              pricing: 500,
              method: "$"
            },
            PayDataExport: {
              pricing: 500,
              method: "$"
            },
            plCount: {
              pricing: 2500,
              addtlPricing: 1250,
              include: 1,
              method: "$"
            },
            npeCount: {
              pricing: 2500,
              addtlPricing: 1250,
              method: "$"
            },
            oscpCount: {
              pricing: 500,
              addtlPricing: 250,
              method: "$"
            },
            histSubmissions: {
              pricing: 1250,
              method: "$"
            },
            emailsAsNotes: {
              pricing: .07,
              method: "%"
            },
            NoDataMigration: {
              pricing: .15,
              method: "%"
            },
          }
        },
        form: {},
        calcs: {
          isBBO: false,
          productsPrice: 0,
          pricePerUser: 0,
          additions: 0,
        },
      };

      var formatter = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
        maximumSignificantDigits: 4,
      });

      var fmtPct = new Intl.NumberFormat("en-US", {
        style: "percent",
      });

      // Get data from the form
      container.form = {};
      container.form.products = [];

      // Loop through the form data
      var form = document.getElementById("form");
      var data = new FormData(form);
      for (var [key, value] of data) {
        container.form[key] = value;
      }

      // Process products
      Object.entries(container.lookup.products).forEach(entry => {
        let [key, value] = entry;

        if (document.getElementById(key).checked) {

          // Put the name into the products array
          container.form.products.push(value.name);

          // Add to pricing
          container.calcs.productsPrice += Number(value.pricing);

          // Set backoffice based on the product choices
          if (key === "time_expense" || key === "invoicing") {
            container.form.backoffice = "BBO";
            container.form.isBBO = true;
          }
          if (key === "pay_bill") {
            container.form.isBH1 = true;
            container.form.backoffice = "BH1"
          }
        }
      })

      // Find Volume container.lookup.discount
      container.form.userCount = Number(container.form.userCount);
      switch (true) {
        case container.form.userCount >= 100:
          container.lookup.discount = .5;
          break;
        case container.form.userCount >= 60:
          container.lookup.discount = .4;
          break;
        case container.form.userCount >= 40:
          container.lookup.discount = .4;
          break;
        case container.form.userCount >= 20:
          container.lookup.discount = .35;
          break;
        case container.form.userCount >= 15:
          container.lookup.discount = .3;
          break;
        default:
          container.lookup.discount = 0;
          break;
      }
      if (container.lookup.discount)
        document.getElementById("discount").innerHTML = fmtPct.format(
          container.lookup.discount
        );

      // If number of users is less than 3 then calculate based on 3
      container.calcs.userCountCalculated = container.form.userCount;
      if (container.calcs.userCountCalculated < 3)
        container.calcs.userCountCalculated = 3;

      // Figure out padding
      if (container.form.isBBO) container.lookup.padding = container.lookup.paddingBBO;
      if (container.form.isBH1) container.lookup.padding = container.lookup.paddingBH1;

      // Perform Calculations
      container.calcs.pricePerUser = (container.lookup.baseUserPrice + container.calcs.productsPrice) * (1 - container.lookup.discount);
      container.calcs.basePricing = container.calcs.pricePerUser * container.calcs.userCountCalculated;
      container.calcs.ballParkLow = container.calcs.basePricing;
      container.calcs.ballParkHigh = container.calcs.basePricing + container.lookup.padding * (1 + container.lookup.buffer);
      container.calcs.ballParkHigh2 = (container.calcs.basePricing + container.lookup.padding) * (1 + container.lookup.buffer);

      // Process additions
      Object.entries(container.lookup.additions).forEach(entry => {
        let [key, value] = entry;

        // If this form field is an input, we can expect a number
        if (document.getElementById(key).value > 0) {
          let count = document.getElementById(key).value;

          // If we include some, then factor that in.
          if (value.include > 0) count = count - 1;
          if (count > 0) {

            // Add the first one
            container.calcs.additions += value.pricing;

            // If we charge less for addditional ones, do that work first
            if (count > 1 && value.addtlPricing) container.calcs.additions += (count - 1) * value.addtlPricing;
          }
        }

        // If this form field is a checkbox
        if (document.getElementById(key).type === "checkbox") {
          // If it's a dollar amount, add it
          if (value.method === "$") {
            if (document.getElementById(`${key}_pricing`)) document.getElementById(`${key}_pricing`).innerHTML = formatter.format(value.pricing);
            if (document.getElementById(key).checked) container.calcs.additions += value.pricing;
          }

          // If its a percent multiply it
          if (value.method === "%") {
            if (document.getElementById(`${key}_pricing`)) document.getElementById(`${key}_pricing`).innerHTML = formatter.format(Math.ceil(container.calcs.basePricing * value.pricing / 10) * 10) + " (" + fmtPct.format(value.pricing) + ")";
            if (document.getElementById(key).checked) container.calcs.additions = container.calcs.basePricing * value.pricing
          }
        }
      })

      // Set option pricing
      document.getElementById("onSiteTrainingAmt").value = Math.ceil((container.calcs.basePricing * 0.07) / 100) * 100;
      document.getElementById("afterCareAmt").value = Math.ceil((container.calcs.basePricing * 0.15) / 100) * 100;

      // Calculate Grand Total
      container.calcs.grandTotal = container.calcs.basePricing + container.calcs.additions;

      // Show prices
      document.getElementById("pricing_companyName").innerHTML = container.form.companyName;
      document.getElementById("pricing_ballpark").innerHTML = formatter.format(Math.ceil(container.calcs.ballParkLow / 500) * 500) + "-" + formatter.format(Math.ceil(container.calcs.ballParkHigh / 500) * 500);
      document.getElementById("pricing_ballpark2").innerHTML = formatter.format(Math.ceil(container.calcs.ballParkLow / 500) * 500) + "-" + formatter.format(Math.ceil(container.calcs.ballParkHigh2 / 500) * 500);
      document.getElementById("pricing_basePricing").innerHTML = formatter.format(Math.ceil(container.calcs.basePricing / 10) * 10);
      document.getElementById("pricing_additions").innerHTML = Math.ceil(container.calcs.additions);
      document.getElementById("pricing_grandTotal").innerHTML = formatter.format(Math.ceil(container.calcs.grandTotal / 10) * 10);

      // Setup for sending to document creation
      container.data = container.form;

      // Put Grand Total in the data packet
      container.data.totalAmt = container.calcs.grandTotal;

      // If we have an override price amount, put grandTotal in a separate spot and then set totalAmt to the override price
      if (container.form.overridePriceAmt) {
        container.data.totalAmt = container.calcs.grandTotal;
        container.data.overridePriceAmt = container.calcs.overridePriceAmt;
        container.data.totalAmt = container.form.overridePriceAmt;
      }

      // Number of weeks
      container.data.timelineWeeks = container.form.timelineLow + " - " + container.form.timelineHigh + " weeks";
      delete container.data.timelineLow;
      delete container.data.timelineHigh;

      // Set timeline
      container.data[`timeline${container.data.timelineTemplate}`] = true;

      // Build URL to link to
      let baseURL = window.location.href + "?";
      let linkURL = "";
      for (const key in container.form) {
        if (container.form[key]) linkURL += "&" + `${key}=${container.form[key]}`;
      }
      document.getElementById('linkURL').setAttribute('href', baseURL + encodeURI(linkURL));

      // Save to textarea
      document.getElementById("rawOutput").innerHTML = JSON.stringify(
        container.data,
        null,
        4
      );
      // console.log(JSON.stringify(container, null, 4));

      funcBackOfficeOptions();
    }

    // Form automation
    function funcBackOfficeOptions(backoffice) {

      // If it's BBO
      if (backoffice === "BBO" && event.target.checked) {
        document.getElementById("pay_bill").checked = false;

        // Set labels
        document.getElementById("pay_bill_label").className = "form-check-label text-black-50";
        document.getElementById("time_expense_label").className = "form-check-label";
        document.getElementById("invoicing_label").className = "form-check-label";
      }

      // If it's BH1
      if (backoffice === "BH1" && event.target.checked) {
        console.log("two")
        document.getElementById("time_expense").checked = false;
        document.getElementById("invoicing").checked = false;

        // Set the timeline template
        document.getElementById("timelineTemplate").value = "BH1";

        // Set labels
        document.getElementById("pay_bill_label").className = "form-check-label";
        document.getElementById("time_expense_label").className = "form-check-label text-black-50";
        document.getElementById("invoicing_label").className = "form-check-label text-black-50";
      }

      // If it's either one, unhide the backoffice options. If it's neither, hide them and reset the labels
      if (document.getElementById("pay_bill").checked || document.getElementById("time_expense").checked || document.getElementById("invoicing").checked) {
        document.getElementById("backoffice_options_div").className = "row mb-3";
      }
      else {
        document.getElementById("backoffice_options_div").className = "row mb-3 d-none";
        document.getElementById("time_expense_label").className = "form-check-label";
        document.getElementById("invoicing_label").className = "form-check-label";
        document.getElementById("pay_bill_label").className = "form-check-label";
      }

      // Before we wrap up, test all the checkboxes and show only what's appropriate
      // If pay/bill is checked we'll show both invoice and pay data export
      if (document.getElementById("pay_bill").checked) {
        document.getElementById("backoffice_options_div").className = "row mb-3";
        document.getElementById("InvoiceExport_div").className = "form-check form-switch";
        document.getElementById("PayDataExport_div").className = "form-check form-switch";
      }
      else {
        // Uncheck and hide the options
        document.getElementById("PayDataExport_div").className = "form-check form-switch d-none";
        document.getElementById("InvoiceExport_div").className = "form-check form-switch d-none";
        document.getElementById("qbIntegration").checked = false;
        document.getElementById("InvoiceExport").checked = false;
        document.getElementById("PayDataExport").checked = false;

        // If applicable, enable the checkboxes
        if (document.getElementById("invoicing").checked) document.getElementById("InvoiceExport_div").className = "form-check form-switch";
        if (document.getElementById("time_expense").checked) document.getElementById("PayDataExport_div").className = "form-check form-switch";
      }
    }

    function funcPriceOverride() {
      if (document.getElementById("overridePrice").checked) {
        overridePrice_div.className = "";
      } else {
        overridePrice_div.className = "d-none";
      }
    }

    function funcOnSiteTraining() {
      if (document.getElementById("onSiteTraining").checked) {
        onSiteTraining_div.className = "";
      } else {
        onSiteTraining_div.className = "d-none";
      }
    }

    function funcAfterCare() {
      if (document.getElementById("afterCare").checked) {
        afterCare_div.className = "";
      } else {
        afterCare_div.className = "d-none";
      }
    }

    function funcTimelineTemplate() {
      switch (document.getElementById("timelineTemplate").value) {
        case "NoDM":
          document.getElementById("timelineLow").value = "9";
          document.getElementById("timelineHigh").value = "12";
          break;
        case "SMB":
          document.getElementById("timelineLow").value = "10";
          document.getElementById("timelineHigh").value = "16";
          break;
        case "Field":
          document.getElementById("timelineLow").value = "13";
          document.getElementById("timelineHigh").value = "18";
          break;
        case "BH1":
          document.getElementById("timelineLow").value = "24";
          document.getElementById("timelineHigh").value = "36";
          break;
        default:
          break;
      }
    }
  </script>
</head>

<body>
  <div class="container-md">
    <form action="proposalCalculator.html" id="form" name="form" method="GET" class="needs-validation" novalidate>
      <h1 class="display-6" onclick="window.location='proposalCalculator.html'">Tonic HQ Pricing Calculator</h1>

      <div class="accordion" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
              <h5>Basic Information</h5>
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <div class="row mb-3">
                <div class="col-sm-2">Company Name</div>
                <div class="col-sm-6">
                  <input type="text" class="form-control" id="companyName" name="companyName" required>
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-sm-2">Number of Users</div>
                <div class="col-sm-2">
                  <input type="number" class="form-control" id="userCount" name="userCount" value="10" min="1" max="150" />
                  <div class="invalid-feedback">
                    Please enter number of users
                  </div>
                </div>
              </div>
              <br />
              <div class="row mb-3">
                <div class="col-sm-2">Products</div>
                <div class="col-sm-auto">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="ats" name="ats" value="true" CHECKED>
                    <label class="form-check-label" for="ats">
                      ATS
                    </label>
                  </div>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="crm" name="crm" value="true">
                    <label class="form-check-label" for="crm">
                      CRM
                    </label>
                  </div>
                  <div class="form-check form-switch" id="time_expense_div">
                    <input class="form-check-input" type="checkbox" id="time_expense" name="time_expense" value="true" onchange="funcBackOfficeOptions('BBO');">
                    <label class="form-check-label" id="time_expense_label" for="time_expense">
                      Time/Expense
                    </label>
                  </div>
                  <div class="form-check form-switch" id="invoicing_div">
                    <input class="form-check-input" type="checkbox" id="invoicing" name="invoicing" value="true" onchange="funcBackOfficeOptions('BBO');">
                    <label class="form-check-label" id="invoicing_label" for="invoicing">
                      Invoicing
                    </label>
                  </div>
                  <div class="form-check form-switch" id="pay_bill_div">
                    <input class="form-check-input" type="checkbox" id="pay_bill" name="pay_bill" value="true" onchange="funcBackOfficeOptions('BH1');">
                    <label class="form-check-label" id="pay_bill_label" for="pay_bill">
                      Pay/Bill <span class="badge bg-secondary bg-warning text-dark">Testing</span>
                    </label>
                  </div>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="onboarding" name="onboarding" value="true">
                    <label class="form-check-label" for="onboarding">
                      Onboarding
                    </label>
                  </div>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="vms_submittals" name="vms_submittals" value="true">
                    <label class="form-check-label" for="vms_submittals">
                      VMS Submittals
                    </label>
                  </div>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="vms_sync" name="vms_sync" value="true">
                    <label class="form-check-label" for="vms_sync">
                      VMS Sync
                    </label>
                  </div>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="canvas" name="canvas" value="true">
                    <label class="form-check-label" for="canvas">
                      Canvas
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingAdditions">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAdditions" aria-expanded="false" aria-controls="collapseAdditions">
              <h5>Additions</h5>
            </button>
          </h2>
          <div id="collapseAdditions" class="accordion-collapse collapse" aria-labelledby="headingAdditions" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <div class="row mb-3">
                <div class="col-sm-2">New Hire Export</div>
                <div class="col-sm">
                  <div class="form-check form-switch">
                    <input class="form-check-input position-static" type="checkbox" id="newHireExport" name="newHireExport" value="true" /> <small><span class="text-black-50" id="newHireExport_pricing"></span></small>
                  </div>
                </div>
              </div>

              <div class="row mb-3 d-none" id="backoffice_options_div">
                <div class="col-sm-2">Back Office Options</div>
                <div class="col-sm-6">
                  <div id="qbIntegration_div" class="form-check form-switch">
                    <input class="form-check-input position-static" type="checkbox" id="qbIntegration" name="qbIntegration" value="true" />
                    Quickbooks Integration <small><span class="text-black-50" id="qbIntegration_pricing"></span></small>
                  </div>
                  <div id="InvoiceExport_div" class="form-check form-switch">
                    <input class="form-check-input position-static" type="checkbox" id="InvoiceExport" name="InvoiceExport" value="true" />
                    Invoice Export <small><span class="text-black-50" id="InvoiceExport_pricing"></span></small>
                  </div>
                  <div id="PayDataExport_div" class="form-check form-switch">
                    <input class="form-check-input position-static" type="checkbox" id="PayDataExport" name="PayDataExport" value="true" />
                    Pay Data Export <small><span class="text-black-50" id="PayDataExport_pricing"></span></small>
                  </div>
                </div>
              </div>

              <div class="form-group row mb-3">
                <div class="col-sm-2">Private Labels</div>
                <div class="col-sm-2">
                  <input type="number" class="form-control" id="plCount" name="plCount" value="1" min="1" max="5" /> <small><span class="text-black-50" id="plCount_pricing"></span></small>
                  <div class="invalid-feedback">
                    Please enter number of PLs
                  </div>
                </div>
              </div>

              <div class="form-group row mb-3">
                <div class="col-sm-2">Non-Production Environments</div>
                <div class="col-sm-2">
                  <input type="number" class="form-control" id="npeCount" name="npeCount" min="0" max="5" /> <small><span class="text-black-50" id="npeCount_pricing"></span></small>
                  <div class="invalid-feedback">
                    Please enter number of NPEs
                  </div>
                </div>
              </div>

              <div class="form-group row mb-3">
                <div class="col-sm-2">OSCPs</div>
                <div class="col-sm-2">
                  <input type="number" class="form-control" id="oscpCount" name="oscpCount" min="0" max="5" /> <small><span class="text-black-50" id="oscpCount_pricing"></span></small>
                  <div class="invalid-feedback">
                    Please enter number of OSCPs
                  </div>
                </div>
              </div>
              <br />

              <div class="row mb-3">
                <div class="col-sm-2">Other Options</div>
                <div class="col-sm-6">
                  <div class="form-check form-switch">
                    <input class="form-check-input position-static" type="checkbox" id="emailsAsNotes" name="emailsAsNotes" value="true" />Are we importing emails as notes? <small><span class="text-black-50" id="emailsAsNotes_pricing"></span></small>
                  </div>
                  <div class="form-check form-switch">
                    <input class="form-check-input position-static" type="checkbox" id="NoDataMigration" name="NoDataMigration" value="true" />No data migration? <small><span class="text-black-50" id="NoDataMigration_pricing"></span></small>
                  </div>
                  <div class="form-check form-switch">
                    <input class="form-check-input position-static" type="checkbox" id="histSubmissions" name="histSubmissions" value="true" />Are we loading historical submissions? <small><span class="text-black-50" id="histSubmissions_pricing"></span></small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOptTHQ">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOptTHQ" aria-expanded="false" aria-controls="collapseOptTHQ">
              <h5>Optional THQ Offerings</h5>
            </button>
          </h2>
          <div id="collapseOptTHQ" class="accordion-collapse collapse" aria-labelledby="headingOptTHQ" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <div class="alert alert-secondary" role="alert">
                Enabling will show the item on the proposal, it does not include it in the price. You can alter the price that's shown on the proposal.
              </div>
              <div class="form-group row mb-3">
                <div class="col-sm-2">On Site Training option?</div>
                <div class="col-sm-2">
                  <div class="form-check form-switch mb-3">
                    <input class="form-check-input position-static" type="checkbox" id="onSiteTraining" name="onSiteTraining" value="true" onchange="funcOnSiteTraining();" />
                  </div>
                  <div class="d-none" id="onSiteTraining_div">
                    <input class="form-control" type="text" id="onSiteTrainingAmt" name="onSiteTrainingAmt" value="" />
                  </div>
                </div>
              </div>

              <div class="form-group row mb-3">
                <div class="col-sm-2">White Glove option?</div>
                <div class="col-sm-2">
                  <div class="form-check form-switch mb-3">
                    <input class="form-check-input position-static" type="checkbox" id="afterCare" name="afterCare" value="true" onchange="funcAfterCare();" />
                  </div>
                  <div class="d-none" id="afterCare_div">
                    <input class="form-control" type="text" id="afterCareAmt" name="afterCareAmt" value="" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingBilling">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBilling" aria-expanded="false" aria-controls="collapseBilling">
              <h5>Billing and Timeline</h5>
            </button>
          </h2>
          <div id="collapseBilling" class="accordion-collapse collapse" aria-labelledby="headingBilling" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <div class="form-group row mb-3">
                <div class="col-sm-2">Number of Payments</div>
                <div class="col-sm-2">
                  <input class="form-control" type="number" id="numPayments" name="numPayments" value="2" min="2" max="3" />
                  <div class="invalid-feedback">
                    Please enter number of Payments
                  </div>
                </div>
              </div>

              <div class="form-group row mb-3">
                <div class="col-sm-2">Timeline (weeks)</div>
                <div class="col-sm-2">
                  <div class="row mb-3">
                    <div class="col-auto">
                      <input class="form-control" type="number" id="timelineLow" name="timelineLow" value="12" min="10" max="52" />
                    </div>
                    <div class="col-3">Low</div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-auto">
                      <input class="form-control" type="number" id="timelineHigh" name="timelineHigh" value="16" min="10" max="52" />
                    </div>
                    <div class="col-3">High</div>
                  </div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-sm-2" data-bs-toggle="tooltip" data-bs-placement="right" title="This determines the timeline table that will be used in the proposal">Timeline Table to use</div>
                <div class="col-sm-3">
                  <select name="timelineTemplate" id="timelineTemplate" class="form-select" aria-label="" onchange="funcTimelineTemplate();">
                    <option value="">-- Please Select --</option>
                    <option value="NoDM">No Data Migration</option>
                    <option value="SMB" selected>SMB</option>
                    <option value="Field">Field</option>
                    <option value="BH1">Bullhorn One</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingSigning">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSigning" aria-expanded="false" aria-controls="collapseSigning">
              <h5>Signing Recipients <span class="badge bg-secondary text-white">Do Not Use</span></h5>
            </button>
          </h2>
          <div id="collapseSigning" class="accordion-collapse collapse" aria-labelledby="headingSigning" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <div class="row mb-3">
                <div class="col-sm-2">THQ Rep</div>
                <div class="col-sm-8">
                  <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Name" aria-label="Name" id="recThqName" name="recThqName" />
                    &nbsp;&nbsp;&nbsp;
                    <span class="input-group-text">@</span>
                    <input type="text" class="form-control" placeholder="Email" aria-label="Email" id="recThqEmail" name="recThqEmail" />
                  </div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-sm-2">Client Signer</div>
                <div class="col-sm-8">
                  <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Name" aria-label="Name" id="recClientName" name="recClientName" />
                    &nbsp;&nbsp;&nbsp;
                    <span class="input-group-text">@</span>
                    <input type="text" class="form-control" placeholder="Email" aria-label="Email" id="recClientEmail" name="recClientEmail" />
                  </div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-sm-2">Bullhorn Rep</div>
                <div class="col-sm-8">
                  <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Name" aria-label="Name" id="recBhName" name="recBhName" />
                    &nbsp;&nbsp;&nbsp;
                    <span class="input-group-text">@</span>
                    <input type="text" class="form-control" placeholder="Email" aria-label="Email" id="reBhEmail" name="reBhEmail" />
                  </div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-sm-2">Additional CC</div>
                <div class="col-sm-8">
                  <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Name" aria-label="Name" id="recCcName" name="recCcName" />
                    &nbsp;&nbsp;&nbsp;
                    <span class="input-group-text">@</span>
                    <input type="text" class="form-control" placeholder="Email" aria-label="Email" id="reCcEmail" name="reCcEmail" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingMisc">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMisc" aria-expanded="false" aria-controls="collapseMisc">
              <h5>Miscellaneous</h5>
            </button>
          </h2>
          <div id="collapseMisc" class="accordion-collapse collapse" aria-labelledby="headingMisc" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <div class="form-group row mb-3">
                <div class="col-sm-2">Price Override</div>
                <div class="col-sm-2">
                  <div class="form-check form-switch mb-3">
                    <input class="form-check-input position-static" type="checkbox" id="overridePrice" name="overridePrice" value="true" onchange="funcPriceOverride();" />
                  </div>
                  <div class="d-none" id="overridePrice_div">
                    <input type="number" class="form-control" id="overridePriceAmt" name="overridePriceAmt" value="" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <br>
        <div class="row">
          <div class="col-12">
            <button type="button" id="resetForm" class="btn btn-secondary">Reset Form</button>
            <button class="btn btn-primary" type="submit">Submit form</button>
            <button class="btn btn-primary" type="button" onclick="generate()">Generate Proposal</button>
          </div>
        </div>
      </div>
    </form>
    <br /><br />
    <h1 class="display-6">Pricing Results</h1>
    <div class="row">
      <div class="col-sm-6">
        <table class="table table-striped table-hover">
          <tbody>
            <tr>
              <td>Client:</td>
              <td><span id="pricing_companyName"></span></td>
            </tr>
            <tr>
              <td>Ballpark:</td>
              <td><span id="pricing_ballpark"></span></td>
            </tr>
            <tr>
              <td>Ballpark2:</td>
              <td><span id="pricing_ballpark2"></span> <span class="badge bg-secondary bg-warning text-dark">Testing</span></td>
            </tr>
            <tr>
              <td>Base Pricing:</td>
              <td>
                <span id="pricing_basePricing"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <small><span class="text-muted" id="discount"></span></small>
              </td>
            </tr>
            <tr>
              <td>Additions:</td>
              <td><span id="pricing_additions"></span></td>
            </tr>
            <tr>
              <td>Grand Total:</td>
              <td><span id="pricing_grandTotal"></span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <br /><br /><br /><br /><br />
    <pre><span id="rawOutput"></span></pre>
    <pre><a href="" id="linkURL">Link to this Pricing</a></pre>
    <br><br><br>
    <pre><a href="file:///C:/Source/ddonathan/sales/proposalCalculator.html?userCount=50&ats=true&crm=true&pay_bill=true&onboarding=true&canvas=true">Bullhorn One</a></pre>
  </div>

  <script>
    // Form Validation
    (function () {
      "use strict";
      window.addEventListener(
        "load",
        function () {
          // Fetch all the forms we want to apply custom Bootstrap validation styles to
          var forms = document.getElementsByClassName("needs-validation");
          // Loop over them and prevent submission
          var validation = Array.prototype.filter.call(
            forms,
            function (form) {
              form.addEventListener(
                "submit",
                function (event) {
                  if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                  }
                  form.classList.add("was-validated");
                },
                false
              );
            }
          );
        },
        false
      );
    })();
  </script>

  <!-- Bootstrap bundle-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
</body>

</html>